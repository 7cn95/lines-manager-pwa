<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title><%= title || 'ููุญุฉ ุงูุชุญูู' %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#e0e5ec" />
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <div class="app-container">
    <header class="app-header neu-surface">
      <div class="header-left">
        <div class="header-title">ููุญุฉ ุงูุชุญูู โ ุฅุฏุงุฑุฉ ุฎุทูุท ุงูุงุชุตุงู</div>
        <div class="header-subtitle">
          ุชูุงุตูู ูุงููุฉ + ุชุฌุฏูุฏ + ุฅุถุงูุฉ + ุชุนุฏูู + ุญุฐู (ูููุฏูุฑ ููุท).
        </div>
      </div>
      <div class="header-right">
        <a href="/" class="neu-button small">ุงููุงุฌูุฉ ุงูุนุงูุฉ</a>
        <form action="/logout" method="post" style="display:inline;">
          <button type="submit" class="neu-button small">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </form>
      </div>
    </header>

    <main class="app-main">
      <% if (error && error.length) { %>
        <div class="alert alert-error neu-surface">
          <% error.forEach(function(msg) { %><div><%= msg %></div><% }); %>
        </div>
      <% } %>

      <% if (success && success.length) { %>
        <div class="alert alert-success neu-surface">
          <% success.forEach(function(msg) { %><div><%= msg %></div><% }); %>
        </div>
      <% } %>

      <div class="toolbar-row">
        <div class="summary-row small">
          <div class="summary-card neu-surface">
            <div class="summary-label">ุฅุฌูุงูู</div>
            <div class="summary-value"><%= stats.total %></div>
          </div>
          <div class="summary-card neu-surface">
            <div class="summary-label">ูุนูุงูุฉ</div>
            <div class="summary-value"><%= stats.active %></div>
          </div>
          <div class="summary-card neu-surface">
            <div class="summary-label">ุณุชูุชูู ุฎูุงู ูง ุฃูุงู</div>
            <div class="summary-value"><%= stats.soon %></div>
          </div>
          <div class="summary-card neu-surface">
            <div class="summary-label">ููุชููุฉ</div>
            <div class="summary-value"><%= stats.expired %></div>
          </div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <a href="/admin/lines/new" class="neu-button primary">ุฅุถุงูุฉ ุฎุท ุฌุฏูุฏ</a>
          <a href="/admin/import" class="neu-button">ุงุณุชูุฑุงุฏ CSV</a>
          <form action="/admin/notify-expiring" method="post" style="display:inline;">
            <button type="submit" class="neu-button">ุฅุฑุณุงู ุฅุดุนุงุฑ ููููุชููุฉ/ุงููุฑูุจุฉ</button>
          </form>
        </div>
      </div>

      <section class="lines-section neu-surface">
        <h2 class="section-title">ุงูุฎุทูุท</h2>
        <% if (!lines.length) { %>
          <p class="empty-state">ูุง ุชูุฌุฏ ุฎุทูุท ูุณุฌูุฉ ุจุนุฏ.</p>
        <% } else { %>
          <div class="lines-list admin">
            <% lines.forEach(function(line) { %>
              <div class="line-card neu-surface">
                <div class="line-header">
                  <div>
                    <div class="line-name"><%= line.person_name %></div>
                    <div class="line-job">
                      <%= line.job_title || 'โ' %> โ <%= line.workplace || 'โ' %>
                    </div>
                  </div>
                  <% if (line.status === 'ACTIVE') { %>
                    <span class="badge badge-active">ูุนูุงู</span>
                  <% } else if (line.status === 'EXPIRING_SOON') { %>
                    <span class="badge badge-soon">ุณููุชูู ุฎูุงู ูง ุฃูุงู</span>
                  <% } else if (line.status === 'EXPIRED') { %>
                    <span class="badge badge-expired">ููุชูู</span>
                  <% } %>
                </div>

                <div class="line-meta">
                  <div>๐ฑ <b><%= line.phone_number %></b></div>
                  <div>๐ฐ ุงูุจุงูุฉ: <%= line.package_amount ? line.package_amount + ' ุฏ.ุน' : 'โ' %></div>
                  <div>โฐ ุงูุชูุงุก: <%= line.expiry_date || 'โ' %></div>
                  <div>๐ ุฅุถุงูุฉ: <%= line.created_at || 'โ' %></div>
                </div>

                <div class="line-footer">
                  <form action="/admin/lines/<%= line.id %>/renew" method="post" style="display:inline;">
                    <button type="submit" class="neu-button primary">ุชุฌุฏูุฏ ุดูุฑ</button>
                  </form>
                  <a href="/admin/lines/<%= line.id %>/edit" class="neu-button">ุชุนุฏูู</a>
                  <form action="/admin/lines/<%= line.id %>/delete" method="post" style="display:inline;" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฎุทุ');">
                    <button type="submit" class="neu-button danger">ุญุฐู</button>
                  </form>
                </div>
              </div>
            <% }); %>
          </div>
        <% } %>
      </section>
    </main>
  </div>

  <script src="/push-client.js"></script>
</body>
</html>